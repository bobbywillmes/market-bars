<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Market Bars</title>
    <style>
      html, body { height: 100%; }
      body { display:flex; flex-direction: column; }
      :root { --bg:#0f172a; --panel:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#60a5fa; }
      body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:var(--bg); color:var(--text); }
      header { padding:16px 20px; border-bottom:1px solid #1f2937; display:flex; align-items:center; gap:16px; }
      header h1 { font-size:18px; margin:0; }
      main { padding:16px 20px; display:grid; gap:16px; grid-template-columns: 320px 1fr; align-items:start; flex: 1 1 auto; min-height: 0; }
      form { background:var(--panel); padding:16px; border-radius:8px; display:grid; gap:10px; }
      label { font-size:12px; color:var(--muted); display:block; margin-bottom:6px; }
      input, select, button { width:100%; box-sizing:border-box; padding:8px 10px; border-radius:6px; border:1px solid #374151; background:#0b1220; color:var(--text); }
      button { background: var(--accent); color:#03111f; font-weight:600; cursor:pointer; border:none; }
      .row { display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
      .panel { background:var(--panel); padding:16px; border-radius:8px; }
      .content-panel { display:flex; flex-direction: column; min-height: 0; }
      .muted { color:var(--muted); }
      table { width:100%; border-collapse: collapse; }
      th, td { text-align:left; padding:6px 8px; border-bottom:1px solid #1f2937; font-size:12px; }
      thead th { position: sticky; top: 0; background:#0b1220; z-index: 1; }
      canvas { width:100%; height:340px; border:1px solid #1f2937; border-radius:8px; }
      .chips { display:flex; gap:6px; flex-wrap:wrap; margin:6px 0 0; }
      .chip { font-size:12px; padding:2px 8px; border-radius:999px; background:#0b1220; border:1px solid #1f2937; }
      .error { color:#fecaca; }
      .table-wrap { overflow:auto; flex: 1 1 auto; min-height: 0; margin-top:12px; }
      .legend { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-top:8px; }
      .legend .item { display:flex; align-items:center; gap:8px; font-size:12px; color:var(--muted); cursor: pointer; }
      .legend .item.disabled { opacity: .45; }
      .legend .swatch { width:12px; height:12px; border-radius:2px; display:inline-block; border:1px solid #374151; }
      .canvas-wrap { position: relative; width: 100%; }
      .tooltip { position:absolute; pointer-events:none; background:#0b1220; border:1px solid #374151; border-radius:6px; padding:6px 8px; font-size:12px; color:var(--text); box-shadow: 0 4px 16px rgba(0,0,0,0.35); white-space:nowrap; z-index: 5; display:none; }
      .chart-type { display:flex; align-items:center; gap:8px; margin-top:8px; color:var(--muted); font-size:12px; }
      .chart-type select { width:auto; padding:4px 8px; border-radius:6px; border:1px solid #374151; background:#0b1220; color:var(--text); }
      .chart-type select:disabled { opacity: .5; cursor: not-allowed; }
      @media (max-width: 900px) { main { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <header>
      <h1>Market Bars</h1>
      <div class="muted">Fetch bars via Polygon proxy</div>
    </header>
    <main>
      <section class="panel">
        <form id="form">
          <div>
            <label>Tickers (comma separated)</label>
            <input id="tickers" placeholder="AAPL,MSFT,GOOG" value="AAPL,MSFT" />
          </div>
          <div class="row">
            <div>
              <label>From</label>
              <input id="from" type="date" />
            </div>
            <div>
              <label>To</label>
              <input id="to" type="date" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>Timespan</label>
              <select id="timespan">
                <option value="day">day</option>
                <option value="minute">minute</option>
                <option value="hour">hour</option>
                <option value="week">week</option>
                <option value="month">month</option>
              </select>
            </div>
            <div>
              <label>Multiplier</label>
              <input id="multiplier" type="number" value="1" min="1" />
            </div>
          </div>
          <div>
            <label>Intraday options</label>
            <div>
              <input id="rthOnly" type="checkbox" />
              <label for="rthOnly">RTH only (06:30â€“13:00 PT)</label>
            </div>
          </div>
          <div class="row">
            <div>
              <label>Adjusted</label>
              <select id="adjusted">
                <option value="true" selected>true</option>
                <option value="false">false</option>
              </select>
            </div>
            <div>
              <label>Sort</label>
              <select id="sort">
                <option value="asc" selected>asc</option>
                <option value="desc">desc</option>
              </select>
            </div>
          </div>
          <div class="row">
            <button type="submit">Fetch</button>
            <button id="download" type="button">Download CSV</button>
          </div>
          <div id="error" class="error"></div>
        </form>
        <div class="muted" style="margin-top:12px;">
          API: <code>/api/bars</code>
          <div class="chips" id="tags"></div>
        </div>
      </section>
      <section class="panel content-panel">
        <div class="canvas-wrap">
          <canvas id="chart" width="800" height="360"></canvas>
          <canvas id="overlay" width="800" height="360" style="position:absolute; left:0; top:0; pointer-events:none;"></canvas>
          <div id="tooltip" class="tooltip"></div>
        </div>
        <div id="legend" class="legend"></div>
        <div id="chartTypeWrap" class="chart-type">
          <label for="chartTypeSingle">Chart</label>
          <select id="chartTypeSingle">
            <option value="line">Line</option>
            <option value="candle" selected>Candlestick</option>
          </select>
        </div>
        <div id="summary" class="muted" style="margin-top:8px;"></div>
        <div class="table-wrap">
          <table id="table"></table>
        </div>
      </section>
    </main>

    <script type="module" src="/app.js"></script>
  </body>
  </html>
